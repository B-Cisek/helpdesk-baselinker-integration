<?php

declare(strict_types=1);

namespace App\Order\Data;

readonly class Order implements \JsonSerializable
{
    /**
     * @param array<OrderProduct> $products
     */
    public function __construct(
        public int $orderId,
        public int $shopOrderId,
        public string $externalOrderId,
        public string $orderSource,
        public int $orderSourceId,
        public string $orderSourceInfo,
        public int $orderStatusId,
        public bool $confirmed,
        public int $dateConfirmed,
        public int $dateAdd,
        public int $dateInStatus,
        public string $userLogin,
        public string $phone,
        public string $email,
        public string $userComments,
        public string $adminComments,
        public string $currency,
        public string $paymentMethod,
        public string $paymentMethodCod,
        public float $paymentDone,
        public int $deliveryMethodId,
        public string $deliveryMethod,
        public float $deliveryPrice,
        public string $deliveryPackageModule,
        public string $deliveryPackageNr,
        public DeliveryAddress $deliveryAddress,
        public DeliveryPoint $deliveryPoint,
        public InvoiceAddress $invoiceAddress,
        public string $wantInvoice,
        public string $extraField1,
        public string $extraField2,
        public string $orderPage,
        public int $pickState,
        public int $packState,
        public array $products,
    ) {}

    /** @param array<string, mixed> $data */
    public static function fromArray(array $data): self
    {
        return new self(
            orderId: (int) $data['order_id'],
            shopOrderId: (int) $data['shop_order_id'],
            externalOrderId: (string) $data['external_order_id'],
            orderSource: (string) $data['order_source'],
            orderSourceId: (int) $data['order_source_id'],
            orderSourceInfo: (string) $data['order_source_info'],
            orderStatusId: (int) $data['order_status_id'],
            confirmed: (bool) $data['confirmed'],
            dateConfirmed: (int) $data['date_confirmed'],
            dateAdd: (int) $data['date_add'],
            dateInStatus: (int) $data['date_in_status'],
            userLogin: (string) $data['user_login'],
            phone: (string) $data['phone'],
            email: (string) $data['email'],
            userComments: (string) $data['user_comments'],
            adminComments: (string) $data['admin_comments'],
            currency: (string) $data['currency'],
            paymentMethod: (string) $data['payment_method'],
            paymentMethodCod: (string) $data['payment_method_cod'],
            paymentDone: (float) $data['payment_done'],
            deliveryMethodId: (int) $data['delivery_method_id'],
            deliveryMethod: (string) $data['delivery_method'],
            deliveryPrice: (float) $data['delivery_price'],
            deliveryPackageModule: (string) $data['delivery_package_module'],
            deliveryPackageNr: (string) $data['delivery_package_nr'],
            deliveryAddress: DeliveryAddress::fromArray($data),
            deliveryPoint: DeliveryPoint::fromArray($data),
            invoiceAddress: InvoiceAddress::fromArray($data),
            wantInvoice: (string) $data['want_invoice'],
            extraField1: (string) $data['extra_field_1'],
            extraField2: (string) $data['extra_field_2'],
            orderPage: (string) $data['order_page'],
            pickState: (int) $data['pick_state'],
            packState: (int) $data['pack_state'],
            products: array_map(OrderProduct::fromArray(...), $data['products']),
        );
    }

    /** @return array<string, mixed> */
    public function jsonSerialize(): array
    {
        return [
            'order_id' => $this->orderId,
            'shop_order_id' => $this->shopOrderId,
            'external_order_id' => $this->externalOrderId,
            'order_source' => $this->orderSource,
            'order_source_id' => $this->orderSourceId,
            'order_source_info' => $this->orderSourceInfo,
            'order_status_id' => $this->orderStatusId,
            'confirmed' => $this->confirmed,
            'date_confirmed' => $this->dateConfirmed,
            'date_add' => $this->dateAdd,
            'date_in_status' => $this->dateInStatus,
            'user_login' => $this->userLogin,
            'phone' => $this->phone,
            'email' => $this->email,
            'user_comments' => $this->userComments,
            'admin_comments' => $this->adminComments,
            'currency' => $this->currency,
            'payment_method' => $this->paymentMethod,
            'payment_method_cod' => $this->paymentMethodCod,
            'payment_done' => $this->paymentDone,
            'delivery_method_id' => $this->deliveryMethodId,
            'delivery_method' => $this->deliveryMethod,
            'delivery_price' => $this->deliveryPrice,
            'delivery_package_module' => $this->deliveryPackageModule,
            'delivery_package_nr' => $this->deliveryPackageNr,
            'delivery_fullname' => $this->deliveryAddress->fullName,
            'delivery_company' => $this->deliveryAddress->company,
            'delivery_address' => $this->deliveryAddress->address,
            'delivery_city' => $this->deliveryAddress->city,
            'delivery_state' => $this->deliveryAddress->state,
            'delivery_postcode' => $this->deliveryAddress->postcode,
            'delivery_country_code' => $this->deliveryAddress->countryCode,
            'delivery_country' => $this->deliveryAddress->country,
            'delivery_point_id' => $this->deliveryPoint->id,
            'delivery_point_name' => $this->deliveryPoint->name,
            'delivery_point_address' => $this->deliveryPoint->address,
            'delivery_point_postcode' => $this->deliveryPoint->postcode,
            'delivery_point_city' => $this->deliveryPoint->city,
            'invoice_fullname' => $this->invoiceAddress->fullName,
            'invoice_company' => $this->invoiceAddress->company,
            'invoice_nip' => $this->invoiceAddress->nip,
            'invoice_address' => $this->invoiceAddress->address,
            'invoice_city' => $this->invoiceAddress->city,
            'invoice_state' => $this->invoiceAddress->state,
            'invoice_postcode' => $this->invoiceAddress->postcode,
            'invoice_country_code' => $this->invoiceAddress->countryCode,
            'invoice_country' => $this->invoiceAddress->country,
            'want_invoice' => $this->wantInvoice,
            'extra_field_1' => $this->extraField1,
            'extra_field_2' => $this->extraField2,
            'order_page' => $this->orderPage,
            'pick_state' => $this->pickState,
            'pack_state' => $this->packState,
            'products' => $this->products,
        ];
    }
}
